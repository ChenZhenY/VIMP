\hypertarget{SparseInverseMatrix_8h_source}{}\doxysection{Sparse\+Inverse\+Matrix.\+h}
\label{SparseInverseMatrix_8h_source}\index{include/SparseInverseMatrix.h@{include/SparseInverseMatrix.h}}
\mbox{\hyperlink{SparseInverseMatrix_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#ifndef VIMP\_SPARSEINVERSEMATRIX\_H}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#define VIMP\_SPARSEINVERSEMATRIX\_H}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{preprocessor}{\#endif }}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <Eigen/Dense>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <Eigen/Sparse>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <Eigen/SparseCore>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <Eigen/SparseCholesky>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{keyword}{typedef} Eigen::SparseMatrix<double> \mbox{\hyperlink{SparseInverseMatrix_8h_a576290261f623f98671e02129f30cd80}{SpMatrix}};}
\DoxyCodeLine{24 \textcolor{keyword}{using namespace }Eigen;}
\DoxyCodeLine{25 \textcolor{keyword}{using namespace }std;}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{keyword}{namespace }SparseInverse\{}
\DoxyCodeLine{28     \textcolor{keyword}{struct }\mbox{\hyperlink{structSparseInverse_1_1sparse__inverser}{sparse\_inverser}}\{}
\DoxyCodeLine{29         \mbox{\hyperlink{structSparseInverse_1_1sparse__inverser}{sparse\_inverser}}(\textcolor{keyword}{const} \mbox{\hyperlink{SparseInverseMatrix_8h_a576290261f623f98671e02129f30cd80}{SpMatrix}}\& \_input\_sparse):}
\DoxyCodeLine{30         K(\_input\_sparse.cols())\{}
\DoxyCodeLine{31             input\_matrix\_ = \_input\_sparse;}
\DoxyCodeLine{32             inverse\_.resize(K, K);}
\DoxyCodeLine{33             SimplicialLLT<SpMatrix, Eigen::Lower, Eigen::NaturalOrdering<int>> choleskyLLT\{\_input\_sparse\};}
\DoxyCodeLine{34             L\_ = choleskyLLT.matrixL();}
\DoxyCodeLine{35             D\_ = L\_.diagonal().array().square().matrix().asDiagonal();}
\DoxyCodeLine{36             inv\_sqrt\_D\_ = L\_.diagonal().array().inverse().matrix().asDiagonal();}
\DoxyCodeLine{37             L\_ = L\_ * inv\_sqrt\_D\_;}
\DoxyCodeLine{38 }
\DoxyCodeLine{39         \}}
\DoxyCodeLine{40 }
\DoxyCodeLine{41         Eigen::MatrixXd \mbox{\hyperlink{structSparseInverse_1_1sparse__inverser_afc33e087641f57e97c418eacbd1f7d23}{inverse}}()\{}
\DoxyCodeLine{42             cout << \textcolor{stringliteral}{"{}true inverse "{}} << endl << input\_matrix\_.toDense().inverse() << endl;}
\DoxyCodeLine{43             inverse\_(K-\/1, K-\/1) = 1.0 / D\_.coeff(K-\/1, K-\/1);}
\DoxyCodeLine{44             inverse\_(K-\/1, K-\/2) = -\/inverse\_(K-\/1, K-\/1) * L\_.coeff(K-\/1, K-\/2);}
\DoxyCodeLine{45             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k=K-\/2; k>=0; k-\/-\/)\{}
\DoxyCodeLine{46                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j=K-\/1; j>=k; j-\/-\/)\{}
\DoxyCodeLine{48                     \textcolor{keywordtype}{double} value = -\/inverse\_(j, k+1) * L\_.coeff(k+1, k);}
\DoxyCodeLine{49                     \textcolor{keywordflow}{if} (j==k)\{}
\DoxyCodeLine{50                         value += 1.0 / D\_.coeff(j, j);}
\DoxyCodeLine{51                     \}}
\DoxyCodeLine{52                     inverse\_(j, k) = value;}
\DoxyCodeLine{53                     inverse\_(k, j) = value;}
\DoxyCodeLine{54                 \}}
\DoxyCodeLine{55             \}}
\DoxyCodeLine{56             cout << \textcolor{stringliteral}{"{}inverse calculated "{}} << endl << inverse\_ << endl;}
\DoxyCodeLine{57             \textcolor{keywordflow}{return} inverse\_;}
\DoxyCodeLine{58         \}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60         \textcolor{keywordtype}{void} update\_sparse\_precision(\textcolor{keyword}{const} \mbox{\hyperlink{SparseInverseMatrix_8h_a576290261f623f98671e02129f30cd80}{SpMatrix}}\& new\_precision)\{}
\DoxyCodeLine{61             assert(new\_precision.cols() == L\_.cols());}
\DoxyCodeLine{62 }
\DoxyCodeLine{63             input\_matrix\_ = new\_precision;}
\DoxyCodeLine{64             SimplicialLLT<SpMatrix, Eigen::Lower, Eigen::NaturalOrdering<int>> choleskyLLT\{new\_precision\};}
\DoxyCodeLine{65             L\_ = choleskyLLT.matrixL();}
\DoxyCodeLine{66             D\_ = L\_.diagonal().array().square().matrix().asDiagonal();}
\DoxyCodeLine{67             inv\_sqrt\_D\_ = L\_.diagonal().array().inverse().matrix().asDiagonal();}
\DoxyCodeLine{68             L\_ = L\_ * inv\_sqrt\_D\_;}
\DoxyCodeLine{69 }
\DoxyCodeLine{70             cout << \textcolor{stringliteral}{"{}L\_"{}} << endl << L\_.toDense() << endl;}
\DoxyCodeLine{71             cout << \textcolor{stringliteral}{"{}precision"{}} << endl << new\_precision.toDense() << endl;}
\DoxyCodeLine{72             cout << \textcolor{stringliteral}{"{}LDLT"{}} << endl << (L\_ * D\_ * L\_.transpose()).toDense() << endl;}
\DoxyCodeLine{73 }
\DoxyCodeLine{74             cout << \textcolor{stringliteral}{"{}aa"{}} << endl;}
\DoxyCodeLine{75         \}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77         Eigen::MatrixXd \mbox{\hyperlink{structSparseInverse_1_1sparse__inverser_afc33e087641f57e97c418eacbd1f7d23}{inverse}}(\textcolor{keyword}{const} \mbox{\hyperlink{SparseInverseMatrix_8h_a576290261f623f98671e02129f30cd80}{SpMatrix}}\& input\_matrix)\{}
\DoxyCodeLine{78             update\_sparse\_precision(input\_matrix);}
\DoxyCodeLine{79             \textcolor{keywordflow}{return} \mbox{\hyperlink{structSparseInverse_1_1sparse__inverser_afc33e087641f57e97c418eacbd1f7d23}{inverse}}();}
\DoxyCodeLine{80         \}}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         MatrixXd inverse\_;}
\DoxyCodeLine{83         \mbox{\hyperlink{SparseInverseMatrix_8h_a576290261f623f98671e02129f30cd80}{SpMatrix}} L\_;}
\DoxyCodeLine{84         \mbox{\hyperlink{SparseInverseMatrix_8h_a576290261f623f98671e02129f30cd80}{SpMatrix}} input\_matrix\_;}
\DoxyCodeLine{85         \mbox{\hyperlink{SparseInverseMatrix_8h_a576290261f623f98671e02129f30cd80}{SpMatrix}} D\_;}
\DoxyCodeLine{86         \textcolor{keywordtype}{int} K;}
\DoxyCodeLine{87         \mbox{\hyperlink{SparseInverseMatrix_8h_a576290261f623f98671e02129f30cd80}{SpMatrix}} inv\_sqrt\_D\_;}
\DoxyCodeLine{88     \};}
\DoxyCodeLine{89 }
\DoxyCodeLine{90     \textcolor{keyword}{struct }\mbox{\hyperlink{structSparseInverse_1_1dense__inverser}{dense\_inverser}}\{}
\DoxyCodeLine{91         \mbox{\hyperlink{structSparseInverse_1_1dense__inverser}{dense\_inverser}}(\textcolor{keyword}{const} MatrixXd\& \_input\_dense):K\_(\_input\_dense.cols())\{}
\DoxyCodeLine{92             inverse\_.resize(K\_, K\_);}
\DoxyCodeLine{93             input\_dense\_ = \_input\_dense;}
\DoxyCodeLine{94             LLT<MatrixXd, Eigen::Lower> choleskyLDLT = \_input\_dense.llt();}
\DoxyCodeLine{95             L\_ = choleskyLDLT.matrixL();}
\DoxyCodeLine{96 }
\DoxyCodeLine{97             D\_ = L\_.diagonal().array().square().matrix().asDiagonal();}
\DoxyCodeLine{98             inv\_sqrt\_D\_ = D\_.diagonal().array().sqrt().inverse().matrix().asDiagonal();}
\DoxyCodeLine{99             L\_ = L\_ * inv\_sqrt\_D\_;}
\DoxyCodeLine{100         \}}
\DoxyCodeLine{101 }
\DoxyCodeLine{102         Eigen::MatrixXd \mbox{\hyperlink{structSparseInverse_1_1dense__inverser_a58b2afee2028386c8410837a0c11db85}{inverse}}()\{}
\DoxyCodeLine{103 }
\DoxyCodeLine{104             LLT<MatrixXd, Eigen::Lower> choleskyLDLT = input\_dense\_.llt();}
\DoxyCodeLine{105 }
\DoxyCodeLine{106             L\_ = choleskyLDLT.matrixL();}
\DoxyCodeLine{107 }
\DoxyCodeLine{108             D\_ = L\_.diagonal().array().square().matrix().asDiagonal();}
\DoxyCodeLine{109             inv\_sqrt\_D\_ = L\_.diagonal().array().inverse().matrix().asDiagonal();}
\DoxyCodeLine{110 }
\DoxyCodeLine{111             L\_ = L\_ * inv\_sqrt\_D\_;}
\DoxyCodeLine{112 }
\DoxyCodeLine{113             inverse\_(K\_-\/1, K\_-\/1) = 1.0 / D\_(K\_-\/1, K\_-\/1);}
\DoxyCodeLine{114             inverse\_(K\_-\/1, K\_-\/2) = -\/inverse\_(K\_-\/1, K\_-\/1) * L\_(K\_-\/1, K\_-\/2);}
\DoxyCodeLine{115             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k=K\_-\/2; k>=0; k-\/-\/)\{}
\DoxyCodeLine{116                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j=K\_-\/1; j>=k; j-\/-\/)\{}
\DoxyCodeLine{118                     \textcolor{keywordtype}{double} value = -\/inverse\_(j, k+1) * L\_(k+1, k);}
\DoxyCodeLine{119                     \textcolor{keywordflow}{if} (j==k)\{}
\DoxyCodeLine{120                         value += 1.0 / D\_(j, j);}
\DoxyCodeLine{121                     \}}
\DoxyCodeLine{122                     inverse\_(j, k) = value;}
\DoxyCodeLine{123                     inverse\_(k, j) = value;}
\DoxyCodeLine{124                 \}}
\DoxyCodeLine{125             \}}
\DoxyCodeLine{126             \textcolor{keywordflow}{return} inverse\_;}
\DoxyCodeLine{127         \}}
\DoxyCodeLine{128 }
\DoxyCodeLine{129         Eigen::MatrixXd \mbox{\hyperlink{structSparseInverse_1_1dense__inverser_a58b2afee2028386c8410837a0c11db85}{inverse}}(\textcolor{keyword}{const} MatrixXd\& input\_matrix)\{}
\DoxyCodeLine{130             assert(input\_matrix.cols() == L\_.cols());}
\DoxyCodeLine{131             input\_dense\_ = input\_matrix;}
\DoxyCodeLine{132             \textcolor{keywordflow}{return} \mbox{\hyperlink{structSparseInverse_1_1dense__inverser_a58b2afee2028386c8410837a0c11db85}{inverse}}();}
\DoxyCodeLine{133         \}}
\DoxyCodeLine{134 }
\DoxyCodeLine{135         MatrixXd inverse\_;}
\DoxyCodeLine{136         MatrixXd L\_;}
\DoxyCodeLine{137         MatrixXd D\_;}
\DoxyCodeLine{138         \textcolor{keywordtype}{int} K\_;}
\DoxyCodeLine{139         MatrixXd input\_dense\_;}
\DoxyCodeLine{140         MatrixXd inv\_sqrt\_D\_;}
\DoxyCodeLine{141     \};}
\DoxyCodeLine{142 }
\DoxyCodeLine{143 \}}

\end{DoxyCode}
