\hypertarget{OptimizerGH_01ref_8h_source}{}\doxysection{Optimizer\+GH ref.\+h}
\label{OptimizerGH_01ref_8h_source}\index{include/OptimizerGH ref.h@{include/OptimizerGH ref.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <gtsam/base/Matrix.h>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <random>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <utility>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{SparseInverseMatrix_8h}{SparseInverseMatrix.h}}"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <boost/scoped\_ptr.hpp>}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{comment}{//using namespace GaussianSampler;}}
\DoxyCodeLine{20 \textcolor{keyword}{using namespace }std;}
\DoxyCodeLine{21 \textcolor{keyword}{using namespace }SparseInverse;}
\DoxyCodeLine{22 \textcolor{keyword}{typedef} Triplet<double> T;}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 \textcolor{keyword}{namespace }VIMP\{}
\DoxyCodeLine{25     \textcolor{keyword}{template} <\textcolor{keyword}{typename} FactorizedOptimizer>}
\DoxyCodeLine{26 }
\DoxyCodeLine{30 \textcolor{keyword}{class }\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH}{VIMPOptimizerGH}}\{}
\DoxyCodeLine{31 \textcolor{keyword}{public}:}
\DoxyCodeLine{35     \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a725cdac4e1c5203e19e449eefba9848e}{VIMPOptimizerGH}}(\textcolor{keyword}{const} vector<FactorizedOptimizer>\& \_vec\_fact\_optimizers):}
\DoxyCodeLine{36                                    \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}}\{\_vec\_fact\_optimizers[0].Pk().cols()\},}
\DoxyCodeLine{37                                    sub\_dim\{\_vec\_fact\_optimizers[0].Pk().rows()\},}
\DoxyCodeLine{38                                    num\_sub\_vars\{static\_cast<int>(\_vec\_fact\_optimizers.size())\},}
\DoxyCodeLine{39                                    \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_aa0475e770fd002858b29da8fcb629bcd}{vec\_factor\_optimizers\_}}\{\_vec\_fact\_optimizers\},}
\DoxyCodeLine{40                                    \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}}\{VectorXd::Zero(\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}})\},}
\DoxyCodeLine{41                                    Vdmu\_\{VectorXd::Zero(\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}})\},}
\DoxyCodeLine{42                                    d\_mu\_\{VectorXd::Zero(\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}})\},}
\DoxyCodeLine{43                                    precision\_\{MatrixXd::Identity(\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}}, \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}}) * 5.0\},}
\DoxyCodeLine{44                                    Vddmu\_(MatrixXd::Identity(\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}}, \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}})),}
\DoxyCodeLine{45                                    d\_precision\_(MatrixXd::Identity(\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}}, \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}})),}
\DoxyCodeLine{46                                    \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_aa8ef2470a31aad4d28f9562f2537895c}{inverser\_}}\{MatrixXd::Identity(\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}}, \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}})\}\{\}}
\DoxyCodeLine{47 \textcolor{keyword}{protected}:}
\DoxyCodeLine{49     \textcolor{keywordtype}{int} \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a5a1674a6f5f308e4932de5072da241ff}{dim}}, sub\_dim, num\_sub\_vars;}
\DoxyCodeLine{50 }
\DoxyCodeLine{52     vector<FactorizedOptimizer> \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_aa0475e770fd002858b29da8fcb629bcd}{vec\_factor\_optimizers\_}};}
\DoxyCodeLine{53 }
\DoxyCodeLine{58     VectorXd \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}}, Vdmu\_, d\_mu\_;}
\DoxyCodeLine{59     MatrixXd precision\_, Vddmu\_, d\_precision\_;}
\DoxyCodeLine{60 }
\DoxyCodeLine{62     \mbox{\hyperlink{structSparseInverse_1_1dense__inverser}{dense\_inverser}} \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_aa8ef2470a31aad4d28f9562f2537895c}{inverser\_}};}
\DoxyCodeLine{63 }
\DoxyCodeLine{65     \textcolor{keywordtype}{double} \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a0b9379cfc87f1b75c9799fb9e21bdbde}{step\_size\_precision}} = 0.9;}
\DoxyCodeLine{66     \textcolor{keywordtype}{double} step\_size\_mu = 0.9;}
\DoxyCodeLine{67 }
\DoxyCodeLine{68 \textcolor{keyword}{public}:}
\DoxyCodeLine{70     \textcolor{keywordtype}{void} \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a7badcf160909f8dd6e61ff4c6e86646e}{step}}()\{}
\DoxyCodeLine{71         cout << \textcolor{stringliteral}{"{}mu\_ "{}} << endl << \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}} << endl;}
\DoxyCodeLine{72 }
\DoxyCodeLine{73         Vdmu\_.setZero();}
\DoxyCodeLine{74         Vddmu\_.setZero();}
\DoxyCodeLine{75         d\_mu\_.setZero();}
\DoxyCodeLine{76         d\_precision\_.setZero();}
\DoxyCodeLine{77 }
\DoxyCodeLine{78         MatrixXd Sigma\{\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_aa8ef2470a31aad4d28f9562f2537895c}{inverser\_}}.\mbox{\hyperlink{structSparseInverse_1_1dense__inverser_a58b2afee2028386c8410837a0c11db85}{inverse}}(precision\_)\};}
\DoxyCodeLine{79 }
\DoxyCodeLine{80         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k=0; k<num\_sub\_vars; k++)\{}
\DoxyCodeLine{81 }
\DoxyCodeLine{82             FactorizedOptimizer\& optimizer\_k = \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_aa0475e770fd002858b29da8fcb629bcd}{vec\_factor\_optimizers\_}}[k];}
\DoxyCodeLine{83 }
\DoxyCodeLine{84             optimizer\_k.update\_mu(VectorXd\{\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}}\});}
\DoxyCodeLine{85             optimizer\_k.update\_precision\_from\_joint\_covariance(MatrixXd\{Sigma\});}
\DoxyCodeLine{86             optimizer\_k.calculate\_partial\_V();}
\DoxyCodeLine{87 }
\DoxyCodeLine{88             Vdmu\_ = Vdmu\_ + optimizer\_k.get\_joint\_Vdmu();}
\DoxyCodeLine{89             Vddmu\_ = Vddmu\_ + optimizer\_k.get\_joint\_Vddmu();}
\DoxyCodeLine{90 }
\DoxyCodeLine{91         \}}
\DoxyCodeLine{92 }
\DoxyCodeLine{93         d\_precision\_ = -\/precision\_ + Vddmu\_;}
\DoxyCodeLine{94         precision\_ = precision\_ + \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a0b9379cfc87f1b75c9799fb9e21bdbde}{step\_size\_precision}}*d\_precision\_;}
\DoxyCodeLine{95         d\_mu\_ = precision\_.colPivHouseholderQr().solve(-\/Vdmu\_);}
\DoxyCodeLine{96         \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}} = \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}} + step\_size\_mu * d\_mu\_;}
\DoxyCodeLine{97 }
\DoxyCodeLine{98         cout << \textcolor{stringliteral}{"{}mu\_ "{}} << endl << \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}} << endl;}
\DoxyCodeLine{99         cout << \textcolor{stringliteral}{"{}new precision "{}} << endl << precision\_ << endl;}
\DoxyCodeLine{100         }
\DoxyCodeLine{101     \}}
\DoxyCodeLine{102 }
\DoxyCodeLine{104     \textcolor{keywordtype}{void} \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a7951b481303c2d1ece9bd39dd0bb1d68}{step\_closed\_form}}()\{}
\DoxyCodeLine{105 }
\DoxyCodeLine{106         Vdmu\_.setZero();}
\DoxyCodeLine{107         Vddmu\_.setZero();}
\DoxyCodeLine{108         d\_mu\_.setZero();}
\DoxyCodeLine{109         d\_precision\_.setZero();}
\DoxyCodeLine{110 }
\DoxyCodeLine{111         MatrixXd Sigma\{\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_aa8ef2470a31aad4d28f9562f2537895c}{inverser\_}}.\mbox{\hyperlink{structSparseInverse_1_1dense__inverser_a58b2afee2028386c8410837a0c11db85}{inverse}}(precision\_)\};}
\DoxyCodeLine{112 }
\DoxyCodeLine{113         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k=0; k<num\_sub\_vars; k++)\{}
\DoxyCodeLine{114 }
\DoxyCodeLine{115             FactorizedOptimizer\& optimizer\_k = \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_aa0475e770fd002858b29da8fcb629bcd}{vec\_factor\_optimizers\_}}[k];}
\DoxyCodeLine{116             }
\DoxyCodeLine{117             optimizer\_k.update\_mu(VectorXd\{\mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}}\});}
\DoxyCodeLine{118             optimizer\_k.update\_precision\_from\_joint\_covariance(MatrixXd\{Sigma\});}
\DoxyCodeLine{119             optimizer\_k.calculate\_exact\_partial\_V();}
\DoxyCodeLine{120 }
\DoxyCodeLine{121             Vdmu\_ = Vdmu\_ + optimizer\_k.get\_joint\_Vdmu();}
\DoxyCodeLine{122             Vddmu\_ = Vddmu\_ + optimizer\_k.get\_joint\_Vddmu();}
\DoxyCodeLine{123             }
\DoxyCodeLine{124         \}}
\DoxyCodeLine{125 }
\DoxyCodeLine{126         d\_precision\_ = -\/precision\_ + Vddmu\_;}
\DoxyCodeLine{127 }
\DoxyCodeLine{128         precision\_ = precision\_ + \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a0b9379cfc87f1b75c9799fb9e21bdbde}{step\_size\_precision}}*d\_precision\_;}
\DoxyCodeLine{129 }
\DoxyCodeLine{130         d\_mu\_ = precision\_.colPivHouseholderQr().solve(-\/Vdmu\_);}
\DoxyCodeLine{131         \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}} = \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}} + step\_size\_mu * d\_mu\_;}
\DoxyCodeLine{132 }
\DoxyCodeLine{133         cout << \textcolor{stringliteral}{"{}mu\_ "{}} << endl << \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}} << endl;}
\DoxyCodeLine{134         cout << \textcolor{stringliteral}{"{}new precision "{}} << endl << precision\_ << endl;}
\DoxyCodeLine{135 }
\DoxyCodeLine{136     \}}
\DoxyCodeLine{137 }
\DoxyCodeLine{139     gtsam::Vector \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a8f716aae1af759d942f27cfda698ee6a}{get\_mean}}()\{}
\DoxyCodeLine{140         \textcolor{keywordflow}{return} \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}};}
\DoxyCodeLine{141     \}}
\DoxyCodeLine{142 }
\DoxyCodeLine{144     gtsam::Matrix \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a8e2b37dce35fcc8301480848857d2a32}{get\_precision}}()\{}
\DoxyCodeLine{145         \textcolor{keywordflow}{return} precision\_;}
\DoxyCodeLine{146     \}}
\DoxyCodeLine{147 }
\DoxyCodeLine{149     gtsam::Matrix \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_aba0a67fc827e56cc7d15881a47936b6b}{get\_covariance}}()\{}
\DoxyCodeLine{150         \textcolor{keywordflow}{return} \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_aa8ef2470a31aad4d28f9562f2537895c}{inverser\_}}.\mbox{\hyperlink{structSparseInverse_1_1dense__inverser_a58b2afee2028386c8410837a0c11db85}{inverse}}();}
\DoxyCodeLine{151     \}}
\DoxyCodeLine{152 }
\DoxyCodeLine{156     \textcolor{keywordtype}{void} \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a458fbc726e93214bafa55e635cecc4cd}{set\_step\_size}}(\textcolor{keywordtype}{double} ss\_mean, \textcolor{keywordtype}{double} ss\_precision)\{}
\DoxyCodeLine{157         step\_size\_mu = ss\_mean;}
\DoxyCodeLine{158         \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a0b9379cfc87f1b75c9799fb9e21bdbde}{step\_size\_precision}} = ss\_precision;}
\DoxyCodeLine{159     \}}
\DoxyCodeLine{160 }
\DoxyCodeLine{163     \textcolor{keywordtype}{void} \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_aa84fa8f5a7cb83847d79910889303665}{set\_mu}}(\textcolor{keyword}{const} VectorXd\& \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_ae621d0bd3510ed624a9d4d516e597a9d}{mean}})\{}
\DoxyCodeLine{164         \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_a532261ddbe2c9648d6b8d49b91611999}{mu\_}} = \mbox{\hyperlink{classVIMP_1_1VIMPOptimizerGH_ae621d0bd3510ed624a9d4d516e597a9d}{mean}};}
\DoxyCodeLine{165     \}}
\DoxyCodeLine{166 }
\DoxyCodeLine{167 \};}
\DoxyCodeLine{168 }
\DoxyCodeLine{169 \}}

\end{DoxyCode}
