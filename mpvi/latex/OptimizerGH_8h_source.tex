\hypertarget{OptimizerGH_8h_source}{}\doxysection{Optimizer\+GH.\+h}
\label{OptimizerGH_8h_source}\index{include/OptimizerGH.h@{include/OptimizerGH.h}}
\mbox{\hyperlink{OptimizerGH_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <gtsam/base/Matrix.h>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <random>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <utility>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{SparseInverseMatrix_8h}{SparseInverseMatrix.h}}"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <boost/scoped\_ptr.hpp>}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{comment}{//using namespace GaussianSampler;}}
\DoxyCodeLine{20 \textcolor{keyword}{using namespace }std;}
\DoxyCodeLine{21 \textcolor{keyword}{using namespace }SparseInverse;}
\DoxyCodeLine{22 \textcolor{keyword}{typedef} Triplet<double> T;}
\DoxyCodeLine{23 }
\DoxyCodeLine{24 \textcolor{keyword}{namespace }MPVI\{}
\DoxyCodeLine{25     \textcolor{keyword}{template} <\textcolor{keyword}{typename} FactorizedOptimizer>}
\DoxyCodeLine{26 }
\DoxyCodeLine{30 \textcolor{keyword}{class }VIMPOptimizerGH\{}
\DoxyCodeLine{31 \textcolor{keyword}{public}:}
\DoxyCodeLine{36     \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_ac403b9e88675d0c18230a705701b40a2}{VIMPOptimizerGH}}(\textcolor{keyword}{const} vector<MatrixXd>\& \_vec\_Pks, \textcolor{keyword}{const} vector<std::shared\_ptr<FactorizedOptimizer>>\& \_vec\_fact\_optimizers):}
\DoxyCodeLine{37                                    \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}}\{\_vec\_Pks[0].cols()\},}
\DoxyCodeLine{38                                    sub\_dim\{\_vec\_Pks[0].rows()\},}
\DoxyCodeLine{39                                    num\_sub\_vars\{static\_cast<int>(\_vec\_Pks.size())\},}
\DoxyCodeLine{40                                    \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a458454ee5de48532f4a78cf936c041cf}{vec\_Pks\_}}\{std::move(\_vec\_Pks)\},}
\DoxyCodeLine{41                                    \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a2dcc7d1265a12df19ccc6424ca5a637a}{vec\_factor\_optimizers\_}}\{std::move(\_vec\_fact\_optimizers)\},}
\DoxyCodeLine{42                                    \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}}\{VectorXd::Zero(\mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}})\},}
\DoxyCodeLine{43                                    Vdmu\_\{VectorXd::Zero(\mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}})\},}
\DoxyCodeLine{44                                    d\_mu\_\{VectorXd::Zero(\mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}})\},}
\DoxyCodeLine{45                                    precision\_\{MatrixXd::Identity(\mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}}, \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}}) * 5.0\},}
\DoxyCodeLine{46                                    Vddmu\_(MatrixXd::Identity(\mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}}, \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}})),}
\DoxyCodeLine{47                                    d\_precision\_(MatrixXd::Identity(\mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}}, \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}})),}
\DoxyCodeLine{48                                    \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a67178cf4f86c2fd14b462a54f949421c}{inverser\_}}\{MatrixXd::Identity(\mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}}, \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}})\}\{\}}
\DoxyCodeLine{49 \textcolor{keyword}{protected}:}
\DoxyCodeLine{51     \textcolor{keywordtype}{int} \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aaa4b2cb14718f4fd59da8d6fad55f9b9}{dim}}, sub\_dim, num\_sub\_vars;}
\DoxyCodeLine{52 }
\DoxyCodeLine{54     \textcolor{keyword}{const} vector<MatrixXd> \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a458454ee5de48532f4a78cf936c041cf}{vec\_Pks\_}};}
\DoxyCodeLine{55 }
\DoxyCodeLine{57     vector<std::shared\_ptr<FactorizedOptimizer>> \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a397b72f3d067e998c2da24e6092b663b}{vec\_factor\_optimizers\_}};}
\DoxyCodeLine{58 }
\DoxyCodeLine{63     VectorXd \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}}, Vdmu\_, d\_mu\_;}
\DoxyCodeLine{64     MatrixXd precision\_, Vddmu\_, d\_precision\_;}
\DoxyCodeLine{65 }
\DoxyCodeLine{67     \mbox{\hyperlink{structSparseInverse_1_1dense__inverser}{dense\_inverser}} \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a67178cf4f86c2fd14b462a54f949421c}{inverser\_}};}
\DoxyCodeLine{68 }
\DoxyCodeLine{70     \textcolor{keywordtype}{double} \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aeda71c489d8e8141237869a65379b5de}{step\_size\_precision}} = 0.9;}
\DoxyCodeLine{71     \textcolor{keywordtype}{double} step\_size\_mu = 0.9;}
\DoxyCodeLine{72 }
\DoxyCodeLine{73 \textcolor{keyword}{public}:}
\DoxyCodeLine{75     \textcolor{keywordtype}{void} \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a319b807e484d78f67cdb18b97405f60d}{step}}()\{}
\DoxyCodeLine{76         cout << \textcolor{stringliteral}{"{}mu\_ "{}} << endl << \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}} << endl;}
\DoxyCodeLine{77 }
\DoxyCodeLine{78         Vdmu\_.setZero();}
\DoxyCodeLine{79         Vddmu\_.setZero();}
\DoxyCodeLine{80         d\_mu\_.setZero();}
\DoxyCodeLine{81         d\_precision\_.setZero();}
\DoxyCodeLine{82 }
\DoxyCodeLine{83         MatrixXd Sigma\{\mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a67178cf4f86c2fd14b462a54f949421c}{inverser\_}}.\mbox{\hyperlink{structSparseInverse_1_1dense__inverser_a58b2afee2028386c8410837a0c11db85}{inverse}}(precision\_)\};}
\DoxyCodeLine{84 }
\DoxyCodeLine{85         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k=0; k<num\_sub\_vars; k++)\{}
\DoxyCodeLine{86 }
\DoxyCodeLine{87             \textcolor{keyword}{const} MatrixXd\& Pk = \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a458454ee5de48532f4a78cf936c041cf}{vec\_Pks\_}}[k];}
\DoxyCodeLine{88 }
\DoxyCodeLine{89             std::shared\_ptr<FactorizedOptimizer> optimizer\_k = \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a2dcc7d1265a12df19ccc6424ca5a637a}{vec\_factor\_optimizers\_}}[k];}
\DoxyCodeLine{90 }
\DoxyCodeLine{91             optimizer\_k-\/>update\_mu(VectorXd\{Pk*\mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}}\});}
\DoxyCodeLine{92             optimizer\_k-\/>update\_precision(MatrixXd\{(Pk * Sigma * Pk.transpose()).inverse()\});}
\DoxyCodeLine{93 }
\DoxyCodeLine{94             cout << \textcolor{stringliteral}{"{}Pk"{}} << endl << Pk << endl;}
\DoxyCodeLine{95 }
\DoxyCodeLine{96             optimizer\_k-\/>calculate\_partial\_V();}
\DoxyCodeLine{97 }
\DoxyCodeLine{98             cout << \textcolor{stringliteral}{"{}mu\_ "{}} << endl << \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}} << endl;}
\DoxyCodeLine{99 }
\DoxyCodeLine{100             Vdmu\_ = Vdmu\_ + Pk.transpose() * optimizer\_k-\/>get\_Vdmu();}
\DoxyCodeLine{101 }
\DoxyCodeLine{102             cout << \textcolor{stringliteral}{"{}mu\_ "{}} << endl << \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}} << endl;}
\DoxyCodeLine{103             Vddmu\_ = Vddmu\_ + Pk.transpose().eval() * optimizer\_k-\/>get\_Vddmu() * Pk;}
\DoxyCodeLine{104 }
\DoxyCodeLine{105             cout << \textcolor{stringliteral}{"{}mu\_ "{}} << endl << \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}} << endl;}
\DoxyCodeLine{106 }
\DoxyCodeLine{107         \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109         cout << \textcolor{stringliteral}{"{}Vddmu\_"{}} << Vddmu\_ << endl;}
\DoxyCodeLine{110         cout << \textcolor{stringliteral}{"{}Vdmu\_"{}} << Vdmu\_ << endl;}
\DoxyCodeLine{111 }
\DoxyCodeLine{112         cout << \textcolor{stringliteral}{"{}precision "{}} << endl << precision\_ << endl;}
\DoxyCodeLine{113 }
\DoxyCodeLine{114         d\_precision\_ = -\/precision\_ + Vddmu\_;}
\DoxyCodeLine{115 }
\DoxyCodeLine{116         precision\_ = precision\_ + \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aeda71c489d8e8141237869a65379b5de}{step\_size\_precision}}*d\_precision\_;}
\DoxyCodeLine{117 }
\DoxyCodeLine{118         d\_mu\_ = precision\_.colPivHouseholderQr().solve(-\/Vdmu\_);}
\DoxyCodeLine{119 }
\DoxyCodeLine{120         \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}} = \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}} + step\_size\_mu * d\_mu\_;}
\DoxyCodeLine{121 }
\DoxyCodeLine{122         cout << \textcolor{stringliteral}{"{}mu\_ "{}} << endl << \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}} << endl;}
\DoxyCodeLine{123         cout << \textcolor{stringliteral}{"{}new precision "{}} << endl << precision\_ << endl;}
\DoxyCodeLine{124         }
\DoxyCodeLine{125     \}}
\DoxyCodeLine{126 }
\DoxyCodeLine{128     \textcolor{keywordtype}{void} \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a8486fb0fb530f9baf792a11ec074ba62}{step\_closed\_form}}()\{}
\DoxyCodeLine{129 }
\DoxyCodeLine{130         Vdmu\_.setZero();}
\DoxyCodeLine{131         Vddmu\_.setZero();}
\DoxyCodeLine{132         d\_mu\_.setZero();}
\DoxyCodeLine{133         d\_precision\_.setZero();}
\DoxyCodeLine{134 }
\DoxyCodeLine{135         MatrixXd Sigma\{\mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a67178cf4f86c2fd14b462a54f949421c}{inverser\_}}.\mbox{\hyperlink{structSparseInverse_1_1dense__inverser_a58b2afee2028386c8410837a0c11db85}{inverse}}(precision\_)\};}
\DoxyCodeLine{136 }
\DoxyCodeLine{137         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k=0; k<num\_sub\_vars; k++)\{}
\DoxyCodeLine{138 }
\DoxyCodeLine{139             \textcolor{keyword}{const} MatrixXd\& Pk = \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a458454ee5de48532f4a78cf936c041cf}{vec\_Pks\_}}[k];}
\DoxyCodeLine{140 }
\DoxyCodeLine{141             std::shared\_ptr<FactorizedOptimizer> optimizer\_k = \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a2dcc7d1265a12df19ccc6424ca5a637a}{vec\_factor\_optimizers\_}}[k];}
\DoxyCodeLine{142             optimizer\_k-\/>updateSamplerMean(VectorXd\{Pk * \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}}\});}
\DoxyCodeLine{143             optimizer\_k-\/>updateSamplerCovarianceMatrix(MatrixXd\{Pk * Sigma * Pk.transpose()\});}
\DoxyCodeLine{144 }
\DoxyCodeLine{145             optimizer\_k-\/>update\_mu(VectorXd\{Pk*\mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}}\});}
\DoxyCodeLine{146             optimizer\_k-\/>update\_precision(MatrixXd\{(Pk * Sigma * Pk.transpose()).inverse()\});}
\DoxyCodeLine{147 }
\DoxyCodeLine{148             optimizer\_k-\/>calculate\_partial\_V();}
\DoxyCodeLine{149 }
\DoxyCodeLine{150             Vdmu\_ = Vdmu\_ + Pk.transpose() * optimizer\_k-\/>get\_Vdmu();}
\DoxyCodeLine{151             Vddmu\_ = Vddmu\_ + Pk.transpose().eval() * optimizer\_k-\/>get\_Vddmu() * Pk;}
\DoxyCodeLine{152         \}}
\DoxyCodeLine{153 }
\DoxyCodeLine{154         d\_precision\_ = -\/precision\_ + Vddmu\_;}
\DoxyCodeLine{155 }
\DoxyCodeLine{156         precision\_ = precision\_ + \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aeda71c489d8e8141237869a65379b5de}{step\_size\_precision}}*d\_precision\_;}
\DoxyCodeLine{157 }
\DoxyCodeLine{158         d\_mu\_ = precision\_.colPivHouseholderQr().solve(-\/Vdmu\_);}
\DoxyCodeLine{159         \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}} = \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}} + step\_size\_mu * d\_mu\_;}
\DoxyCodeLine{160 }
\DoxyCodeLine{161         cout << \textcolor{stringliteral}{"{}mu\_ "{}} << endl << \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}} << endl;}
\DoxyCodeLine{162         cout << \textcolor{stringliteral}{"{}new precision "{}} << endl << precision\_ << endl;}
\DoxyCodeLine{163 }
\DoxyCodeLine{164     \}}
\DoxyCodeLine{165 }
\DoxyCodeLine{167     gtsam::Vector \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a4176459176afcf3fbecceb3b1ea3a7b7}{get\_mean}}()\{}
\DoxyCodeLine{168         \textcolor{keywordflow}{return} \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}};}
\DoxyCodeLine{169     \}}
\DoxyCodeLine{170 }
\DoxyCodeLine{172     gtsam::Matrix \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a31a3f385fb06f0c1452baececd5b99d8}{get\_precision}}()\{}
\DoxyCodeLine{173         \textcolor{keywordflow}{return} precision\_;}
\DoxyCodeLine{174     \}}
\DoxyCodeLine{175 }
\DoxyCodeLine{177     gtsam::Matrix \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aa020bd59c0b0114d5ec9f1b39bbe5b5d}{get\_covariance}}()\{}
\DoxyCodeLine{178         \textcolor{keywordflow}{return} \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a67178cf4f86c2fd14b462a54f949421c}{inverser\_}}.\mbox{\hyperlink{structSparseInverse_1_1dense__inverser_a58b2afee2028386c8410837a0c11db85}{inverse}}();}
\DoxyCodeLine{179     \}}
\DoxyCodeLine{180 }
\DoxyCodeLine{184     \textcolor{keywordtype}{void} \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_ab641cece736b1f33e662264dfa890150}{set\_step\_size}}(\textcolor{keywordtype}{double} ss\_mean, \textcolor{keywordtype}{double} ss\_precision)\{}
\DoxyCodeLine{185         step\_size\_mu = ss\_mean;}
\DoxyCodeLine{186         \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_aeda71c489d8e8141237869a65379b5de}{step\_size\_precision}} = ss\_precision;}
\DoxyCodeLine{187     \}}
\DoxyCodeLine{188 }
\DoxyCodeLine{191     \textcolor{keywordtype}{void} \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a34194c39b78ce3c1ac5c9fb5d0d91fe0}{set\_mu}}(\textcolor{keyword}{const} VectorXd\& mean)\{}
\DoxyCodeLine{192         \mbox{\hyperlink{classMPVI_1_1VIMPOptimizerGH_a1df9530638cb1fa038045ea9ecb7325a}{mu\_}} = mean;}
\DoxyCodeLine{193     \}}
\DoxyCodeLine{194 }
\DoxyCodeLine{195 \};}
\DoxyCodeLine{196 }
\DoxyCodeLine{197 \}}

\end{DoxyCode}
