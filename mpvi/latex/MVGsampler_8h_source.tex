\hypertarget{MVGsampler_8h_source}{}\doxysection{MVGsampler.\+h}
\label{MVGsampler_8h_source}\index{include/MVGsampler.h@{include/MVGsampler.h}}
\mbox{\hyperlink{MVGsampler_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#ifndef C\_DRAFT\_MGVSAMPLER\_H}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#define C\_DRAFT\_MGVSAMPLER\_H}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <Eigen/Dense>}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include <Eigen/Sparse>}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <Eigen/SparseCore>}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include <Eigen/SparseCholesky>}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <random>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{keyword}{using namespace }Eigen;}
\DoxyCodeLine{23 \textcolor{keyword}{using namespace }std;}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{keyword}{const} \textcolor{keywordtype}{double} PI\_ = 3.14159265;}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{keyword}{namespace }GaussianSampler \{}
\DoxyCodeLine{28     \textcolor{keyword}{struct }\mbox{\hyperlink{structGaussianSampler_1_1normal__random__variable}{normal\_random\_variable}} \{}
\DoxyCodeLine{29         \mbox{\hyperlink{structGaussianSampler_1_1normal__random__variable}{normal\_random\_variable}}(MatrixXd \textcolor{keyword}{const} \&covar)}
\DoxyCodeLine{30                 : \mbox{\hyperlink{structGaussianSampler_1_1normal__random__variable}{normal\_random\_variable}}(VectorXd::Zero(covar.rows()), covar) \{\}}
\DoxyCodeLine{31 }
\DoxyCodeLine{32         \mbox{\hyperlink{structGaussianSampler_1_1normal__random__variable}{normal\_random\_variable}}(VectorXd \textcolor{keyword}{const} \&mean, MatrixXd \textcolor{keyword}{const} \&covar)}
\DoxyCodeLine{33                 : mean(mean), covariance(covar) \{}
\DoxyCodeLine{34             SelfAdjointEigenSolver<MatrixXd> eigenSolver(covar);}
\DoxyCodeLine{35             transform = eigenSolver.eigenvectors() * eigenSolver.eigenvalues().cwiseSqrt().asDiagonal();}
\DoxyCodeLine{36 \textcolor{comment}{//            cout << "{}covar eigen transformation "{} << endl << transform << endl;}}
\DoxyCodeLine{37         \}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39         VectorXd mean;}
\DoxyCodeLine{40         MatrixXd transform;}
\DoxyCodeLine{41         MatrixXd covariance;}
\DoxyCodeLine{42 }
\DoxyCodeLine{43         MatrixXd operator()(\textcolor{keyword}{const} \textcolor{keywordtype}{int} \&nn)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{44 \textcolor{comment}{//            static std::mt19937 generator\{std::random\_device\{\}()\};}}
\DoxyCodeLine{45 \textcolor{comment}{//        std::mt19937 gen\{ 1 \};}}
\DoxyCodeLine{46             std::default\_random\_engine generator;}
\DoxyCodeLine{47             std::normal\_distribution<> dist(0, 1);}
\DoxyCodeLine{48 }
\DoxyCodeLine{49             \textcolor{keywordflow}{return} (transform * MatrixXd::NullaryExpr(mean.size(), nn, [\&](\textcolor{keyword}{auto} x) \{ return dist(generator); \})).colwise() +}
\DoxyCodeLine{50                    mean;}
\DoxyCodeLine{51         \}}
\DoxyCodeLine{52 }
\DoxyCodeLine{53         \textcolor{keywordtype}{bool} updateCovariance(\textcolor{keyword}{const} MatrixXd\& new\_cov)\{}
\DoxyCodeLine{54             covariance = new\_cov;}
\DoxyCodeLine{55             SelfAdjointEigenSolver<MatrixXd> eigenSolver(covariance);}
\DoxyCodeLine{56             transform = eigenSolver.eigenvectors() * eigenSolver.eigenvalues().cwiseSqrt().asDiagonal();}
\DoxyCodeLine{57             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{58         \}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60         \textcolor{keywordtype}{bool} updateMean(\textcolor{keyword}{const} VectorXd\& new\_mean)\{}
\DoxyCodeLine{61             mean = new\_mean;}
\DoxyCodeLine{62             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{63         \}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65         MatrixXd get\_covariance()\{}
\DoxyCodeLine{66             \textcolor{keywordflow}{return} covariance;}
\DoxyCodeLine{67         \}}
\DoxyCodeLine{68 }
\DoxyCodeLine{69         MatrixXd get\_precision()\{}
\DoxyCodeLine{70             \textcolor{keywordflow}{return} covariance.inverse();}
\DoxyCodeLine{71         \}}
\DoxyCodeLine{72 }
\DoxyCodeLine{73         VectorXd get\_mean()\{}
\DoxyCodeLine{74             \textcolor{keywordflow}{return} mean;}
\DoxyCodeLine{75         \}}
\DoxyCodeLine{76     \};}
\DoxyCodeLine{77 }
\DoxyCodeLine{78     \textcolor{keyword}{struct }\mbox{\hyperlink{structGaussianSampler_1_1gaussian__sampler__precision}{gaussian\_sampler\_precision}} \{}
\DoxyCodeLine{79         \mbox{\hyperlink{structGaussianSampler_1_1gaussian__sampler__precision}{gaussian\_sampler\_precision}}(MatrixXd \textcolor{keyword}{const} \&precision)}
\DoxyCodeLine{80                 : \mbox{\hyperlink{structGaussianSampler_1_1gaussian__sampler__precision}{gaussian\_sampler\_precision}}(VectorXd::Zero(precision.rows()), precision) \{\}}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         \mbox{\hyperlink{structGaussianSampler_1_1gaussian__sampler__precision}{gaussian\_sampler\_precision}}(VectorXd \textcolor{keyword}{const} \&mean, MatrixXd \textcolor{keyword}{const} \&precision)}
\DoxyCodeLine{83                 : mean(mean) \{}
\DoxyCodeLine{84             precision\_ = precision;}
\DoxyCodeLine{85             LLT<MatrixXd> choleskySolver(precision);}
\DoxyCodeLine{86             LDLT<MatrixXd> choleskySolverLDLT(precision);}
\DoxyCodeLine{87 }
\DoxyCodeLine{88             assert(choleskySolverLDLT.vectorD().minCoeff() > 0);}
\DoxyCodeLine{89             transform = choleskySolver.matrixL();}
\DoxyCodeLine{90 \textcolor{comment}{//            cout << "{}L*LT"{} << endl << transform* transform.transpose() << endl;}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92             transform = transform.inverse().transpose();}
\DoxyCodeLine{93             covariance\_ = precision.inverse();}
\DoxyCodeLine{94 }
\DoxyCodeLine{95         \}}
\DoxyCodeLine{96 }
\DoxyCodeLine{97         VectorXd mean;}
\DoxyCodeLine{98         MatrixXd transform;}
\DoxyCodeLine{99         MatrixXd covariance\_;}
\DoxyCodeLine{100         MatrixXd precision\_;}
\DoxyCodeLine{101 }
\DoxyCodeLine{102         MatrixXd operator()(\textcolor{keyword}{const} \textcolor{keywordtype}{int} \&nn)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{103             \textcolor{keyword}{static} std::mt19937 gen\{std::random\_device\{\}()\};}
\DoxyCodeLine{104 \textcolor{comment}{//        std::mt19937 gen(1);}}
\DoxyCodeLine{105             std::normal\_distribution<> dist(0, 1);}
\DoxyCodeLine{106 \textcolor{comment}{//        return MatrixXd\{transform * MatrixXd\{MatrixXd::NullaryExpr(mean.size(), nn, [\&](auto x) \{ return dist(gen); \})\}\}; //test the fixed seed}}
\DoxyCodeLine{107             \textcolor{keywordflow}{return} (transform * MatrixXd::NullaryExpr(mean.size(), nn, [\&](\textcolor{keyword}{auto} x) \{ return dist(gen); \})).colwise() +}
\DoxyCodeLine{108                    mean;}
\DoxyCodeLine{109         \}}
\DoxyCodeLine{110 }
\DoxyCodeLine{111         \textcolor{keywordtype}{bool} updatePrecisionMatrix(\textcolor{keyword}{const} Eigen::MatrixXd\& newPrecision)}
\DoxyCodeLine{112         \{}
\DoxyCodeLine{113 \textcolor{comment}{//            // not psd, project back}}
\DoxyCodeLine{114             LDLT<MatrixXd> choleskySolverLDLT(newPrecision);}
\DoxyCodeLine{115             Eigen::VectorXd vectorD\{choleskySolverLDLT.vectorD()\};}
\DoxyCodeLine{116 }
\DoxyCodeLine{117             assert(vectorD.minCoeff() > 0);}
\DoxyCodeLine{118 }
\DoxyCodeLine{119             precision\_ = newPrecision;}
\DoxyCodeLine{120             LLT<MatrixXd> choleskySolver(precision\_);}
\DoxyCodeLine{121             transform = choleskySolver.matrixL();}
\DoxyCodeLine{122             transform = transform.inverse().transpose();}
\DoxyCodeLine{123             covariance\_ = precision\_.inverse();}
\DoxyCodeLine{124 }
\DoxyCodeLine{125             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{126         \}}
\DoxyCodeLine{127 }
\DoxyCodeLine{128         \textcolor{keywordtype}{bool} updateMean(\textcolor{keyword}{const} VectorXd\& new\_mean)}
\DoxyCodeLine{129         \{}
\DoxyCodeLine{130             mean = new\_mean;}
\DoxyCodeLine{131             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{132         \}}
\DoxyCodeLine{133 }
\DoxyCodeLine{134 }
\DoxyCodeLine{135     \};}
\DoxyCodeLine{136 }
\DoxyCodeLine{138     \textcolor{keyword}{class }\mbox{\hyperlink{classGaussianSampler_1_1GaussianSamplerSparsePrecision}{GaussianSamplerSparsePrecision}} \{}
\DoxyCodeLine{139     \textcolor{keyword}{public}:}
\DoxyCodeLine{140         \mbox{\hyperlink{classGaussianSampler_1_1GaussianSamplerSparsePrecision}{GaussianSamplerSparsePrecision}}(SparseMatrix<double> \textcolor{keyword}{const} \&precision)}
\DoxyCodeLine{141                 : \mbox{\hyperlink{classGaussianSampler_1_1GaussianSamplerSparsePrecision}{GaussianSamplerSparsePrecision}}(VectorXd::Zero(precision.rows()), precision) \{\}}
\DoxyCodeLine{142 }
\DoxyCodeLine{143         \mbox{\hyperlink{classGaussianSampler_1_1GaussianSamplerSparsePrecision}{GaussianSamplerSparsePrecision}}(VectorXd \textcolor{keyword}{const} \&mean, SparseMatrix<double> \textcolor{keyword}{const} \&precision)}
\DoxyCodeLine{144                 : mean(mean), precision\_(precision) \{}
\DoxyCodeLine{145                 updatePrecisionMatrix(precision);}
\DoxyCodeLine{146         \}}
\DoxyCodeLine{147 }
\DoxyCodeLine{148     \textcolor{keyword}{protected}:}
\DoxyCodeLine{149         VectorXd mean;}
\DoxyCodeLine{150         MatrixXd transform;}
\DoxyCodeLine{151         SparseMatrix<double> precision\_;}
\DoxyCodeLine{152     \textcolor{keyword}{public}:}
\DoxyCodeLine{153         \textcolor{keywordtype}{bool} updatePrecisionMatrix(\textcolor{keyword}{const} SparseMatrix<double>\& newPrecision)}
\DoxyCodeLine{154         \{}
\DoxyCodeLine{155             precision\_ = newPrecision;}
\DoxyCodeLine{156             SimplicialLLT<SparseMatrix<double>, Eigen::Lower, Eigen::NaturalOrdering<int>> sparsecholesky\{precision\_\};}
\DoxyCodeLine{157             SimplicialLDLT<SparseMatrix<double>, Eigen::Lower, Eigen::NaturalOrdering<int>> sparseLDLT\{precision\_\};}
\DoxyCodeLine{158             sparsecholesky.compute(precision\_);}
\DoxyCodeLine{159             cout << \textcolor{stringliteral}{"{}spase cholesky LDLT, D matrix"{}} << endl << sparseLDLT.vectorD() << endl;}
\DoxyCodeLine{160             cout << \textcolor{stringliteral}{"{}sparsecholesky.matrixL() "{}} << endl << sparsecholesky.matrixL() << endl;}
\DoxyCodeLine{161 }
\DoxyCodeLine{162             transform = sparsecholesky.matrixL();}
\DoxyCodeLine{163 }
\DoxyCodeLine{164             \textcolor{comment}{// test dense eigen decomposition}}
\DoxyCodeLine{165             MatrixXd precision\_dense(precision\_);}
\DoxyCodeLine{166             SelfAdjointEigenSolver<MatrixXd> eigenSolver(precision\_dense);}
\DoxyCodeLine{167 }
\DoxyCodeLine{168             \textcolor{keywordflow}{if} (eigenSolver.eigenvalues().minCoeff() < 0)}
\DoxyCodeLine{169             \{}
\DoxyCodeLine{170                 cout << \textcolor{stringliteral}{"{}eigen values "{}} << endl << eigenSolver.eigenvalues() << endl;}
\DoxyCodeLine{171             \}}
\DoxyCodeLine{172 }
\DoxyCodeLine{173             transform = transform.inverse().transpose();}
\DoxyCodeLine{174             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{175         \}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177         \textcolor{keywordtype}{bool} updateMean(\textcolor{keyword}{const} VectorXd\& new\_mean)}
\DoxyCodeLine{178         \{}
\DoxyCodeLine{179             mean = new\_mean;}
\DoxyCodeLine{180             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{181         \}}
\DoxyCodeLine{182 }
\DoxyCodeLine{183         MatrixXd operator()(\textcolor{keyword}{const} \textcolor{keywordtype}{int} \&nn)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{184             \textcolor{keyword}{static} std::mt19937 gen\{std::random\_device\{\}()\};}
\DoxyCodeLine{185 \textcolor{comment}{//        std::mt19937 gen(1);}}
\DoxyCodeLine{186             std::normal\_distribution<> dist(0, 1);}
\DoxyCodeLine{187 \textcolor{comment}{//        return MatrixXd\{transform * MatrixXd\{MatrixXd::NullaryExpr(mean.size(), nn, [\&](auto x) \{ return dist(gen); \})\}\}; //test the fixed seed}}
\DoxyCodeLine{188             \textcolor{keywordflow}{return} (transform * MatrixXd::NullaryExpr(mean.size(), nn, [\&](\textcolor{keyword}{auto} x) \{ return dist(gen); \})).colwise() +}
\DoxyCodeLine{189                    mean;}
\DoxyCodeLine{190         \}}
\DoxyCodeLine{191 }
\DoxyCodeLine{192     \};}
\DoxyCodeLine{193 }
\DoxyCodeLine{195     \textcolor{keyword}{class }\mbox{\hyperlink{classGaussianSampler_1_1Gaussian__distribution}{Gaussian\_distribution}}\{}
\DoxyCodeLine{196     \textcolor{keyword}{public}:}
\DoxyCodeLine{197         \mbox{\hyperlink{classGaussianSampler_1_1Gaussian__distribution}{Gaussian\_distribution}}(\textcolor{keyword}{const} Eigen::VectorXd\& mean, \textcolor{keyword}{const} Eigen::MatrixXd\& covariance):mean\_(mean), Covariance\_(covariance)\{}
\DoxyCodeLine{198             dimension\_ = mean.size();}
\DoxyCodeLine{199             precision\_ = Covariance\_.inverse();}
\DoxyCodeLine{200             SelfAdjointEigenSolver<MatrixXd> eigenSolver(precision\_);}
\DoxyCodeLine{201             assert(eigenSolver.eigenvalues().minCoeff() > 0);}
\DoxyCodeLine{202         \}}
\DoxyCodeLine{204         \textcolor{keywordtype}{double} \mbox{\hyperlink{classGaussianSampler_1_1Gaussian__distribution_a4c109fdc7edf13abd4c5b85d3afe92a0}{probability}}(Eigen::VectorXd x)\textcolor{keyword}{ const}\{}
\DoxyCodeLine{205             \textcolor{keywordtype}{double} temp = (-\/(x-\/mean\_).transpose()*precision\_*(x-\/mean\_))(0)/2.0;}
\DoxyCodeLine{206             \textcolor{keywordflow}{return} exp(temp) / sqrt(pow(2 * PI\_, dimension\_) * Covariance\_.determinant());}
\DoxyCodeLine{207         \}}
\DoxyCodeLine{209         \textcolor{keywordtype}{double} \mbox{\hyperlink{classGaussianSampler_1_1Gaussian__distribution_ac312a7be718da8c7c83cac0e568fcd76}{log\_prob}}(Eigen::VectorXd x)\textcolor{keyword}{ const}\{}
\DoxyCodeLine{210             \textcolor{keywordflow}{return} log(\mbox{\hyperlink{classGaussianSampler_1_1Gaussian__distribution_a4c109fdc7edf13abd4c5b85d3afe92a0}{Gaussian\_distribution::probability}}(x));}
\DoxyCodeLine{211 \textcolor{comment}{//            return -\/((x-\/mean\_).transpose()*precision\_*(x-\/mean\_))(0)/2.0 -\/}}
\DoxyCodeLine{212 \textcolor{comment}{//                    dimension\_ / 2.0 * log(2*PI\_) -\/ log(Covariance\_.determinant()) / 2.0;}}
\DoxyCodeLine{213         \}}
\DoxyCodeLine{214 }
\DoxyCodeLine{216         Eigen::MatrixXd \mbox{\hyperlink{classGaussianSampler_1_1Gaussian__distribution_a51d83dea00de66915fda8684af9619fa}{get\_precision}}()\{}
\DoxyCodeLine{217             \textcolor{keywordflow}{return} precision\_;}
\DoxyCodeLine{218         \}}
\DoxyCodeLine{219 }
\DoxyCodeLine{221         Eigen::VectorXd \mbox{\hyperlink{classGaussianSampler_1_1Gaussian__distribution_af9aceb3281a1b854165b3355c520e324}{get\_mean}}()\{}
\DoxyCodeLine{222             \textcolor{keywordflow}{return} mean\_;}
\DoxyCodeLine{223         \}}
\DoxyCodeLine{224 }
\DoxyCodeLine{226         Eigen::MatrixXd \mbox{\hyperlink{classGaussianSampler_1_1Gaussian__distribution_a24f7a59dafbaed55b4a364eecf65bba5}{get\_covariance}}()\{}
\DoxyCodeLine{227             \textcolor{keywordflow}{return} Covariance\_;}
\DoxyCodeLine{228         \}}
\DoxyCodeLine{229 }
\DoxyCodeLine{230     \textcolor{keyword}{protected}:}
\DoxyCodeLine{231         \textcolor{keywordtype}{int} dimension\_;}
\DoxyCodeLine{232         Eigen::VectorXd mean\_;}
\DoxyCodeLine{233         Eigen::MatrixXd Covariance\_;}
\DoxyCodeLine{234         Eigen::MatrixXd precision\_;}
\DoxyCodeLine{235 }
\DoxyCodeLine{236     \};}
\DoxyCodeLine{237 \}}
\DoxyCodeLine{238 }
\DoxyCodeLine{239 \textcolor{preprocessor}{\#endif }\textcolor{comment}{//C\_DRAFT\_MGVSAMPLER\_H}}

\end{DoxyCode}
